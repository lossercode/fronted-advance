<section id="proxy" class="mb-16 scroll-mt-20">
    <h2 class="text-3xl font-bold mb-6 text-gray-800 border-b-4 border-blue-500 pb-2 inline-block">
        ä»£ç†æ¨¡å¼ (Proxy Pattern)
    </h2>
    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ“Œ æ¦‚å¿µ</h3>
        <p class="text-gray-700 mb-4">
            ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜ç›®æ ‡å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå¢åŠ é¢å¤–çš„åŠŸèƒ½æˆ–æ§åˆ¶è®¿é—®ã€‚
        </p>
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
            <p class="text-gray-700">
                <strong>ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼š</strong> é€šè¿‡ä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨è®¿é—®å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ï¼Œå¦‚æƒé™éªŒè¯ã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ç­‰ã€‚
            </p>
        </div>

        <h3 class="text-xl font-semibold mb-4 mt-6 text-gray-800">ğŸ­ ä»£ç†æ¨¡å¼çš„ç±»å‹</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded">
                <h4 class="font-semibold text-purple-800 mb-2">ğŸ”’ ä¿æŠ¤ä»£ç†</h4>
                <p class="text-sm text-gray-700">æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®æƒé™ï¼Œè¿›è¡Œæƒé™éªŒè¯</p>
            </div>
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <h4 class="font-semibold text-green-800 mb-2">ğŸ’¾ è™šæ‹Ÿä»£ç†</h4>
                <p class="text-sm text-gray-700">å»¶è¿Ÿåˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡ï¼ŒæŒ‰éœ€åŠ è½½</p>
            </div>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <h4 class="font-semibold text-blue-800 mb-2">ğŸ“¦ ç¼“å­˜ä»£ç†</h4>
                <p class="text-sm text-gray-700">ä¸ºå¼€é”€å¤§çš„è¿ç®—ç»“æœæä¾›ç¼“å­˜</p>
            </div>
            <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
                <h4 class="font-semibold text-orange-800 mb-2">ğŸ“ æ—¥å¿—ä»£ç†</h4>
                <p class="text-sm text-gray-700">è®°å½•å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®æ—¥å¿—</p>
            </div>
        </div>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ’» åŸºç¡€ä»£ç ç¤ºä¾‹</h3>
        <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <pre class="line-numbers"><code class="language-javascript">// ç›®æ ‡å¯¹è±¡
class RealImage {
    constructor(filename) {
        this.filename = filename;
        this.loadFromDisk();
    }

    loadFromDisk() {
        console.log(`åŠ è½½å›¾ç‰‡: ${this.filename}`);
    }

    display() {
        console.log(`æ˜¾ç¤ºå›¾ç‰‡: ${this.filename}`);
    }
}

// ä»£ç†å¯¹è±¡
class ProxyImage {
    constructor(filename) {
        this.filename = filename;
        this.realImage = null;
    }

    display() {
        // å»¶è¿ŸåŠ è½½ï¼šåªæœ‰åœ¨çœŸæ­£éœ€è¦æ˜¾ç¤ºæ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡
        if (!this.realImage) {
            this.realImage = new RealImage(this.filename);
        }
        this.realImage.display();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
console.log('åˆ›å»ºä»£ç†å¯¹è±¡...');
const image = new ProxyImage('photo.jpg');

console.log('ç¬¬ä¸€æ¬¡è°ƒç”¨ display:');
image.display();  // æ­¤æ—¶æ‰çœŸæ­£åŠ è½½å›¾ç‰‡

console.log('ç¬¬äºŒæ¬¡è°ƒç”¨ display:');
image.display();  // ç›´æ¥ä½¿ç”¨å·²åŠ è½½çš„å›¾ç‰‡

// è¾“å‡º:
// åˆ›å»ºä»£ç†å¯¹è±¡...
// ç¬¬ä¸€æ¬¡è°ƒç”¨ display:
// åŠ è½½å›¾ç‰‡: photo.jpg
// æ˜¾ç¤ºå›¾ç‰‡: photo.jpg
// ç¬¬äºŒæ¬¡è°ƒç”¨ display:
// æ˜¾ç¤ºå›¾ç‰‡: photo.jpg</code></pre>
        </div>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ” ä¿æŠ¤ä»£ç†ç¤ºä¾‹</h3>
        <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <pre class="line-numbers"><code class="language-javascript">// æ•æ„Ÿæ•°æ®å¯¹è±¡
class SensitiveData {
    constructor() {
        this.data = {
            username: 'admin',
            password: 'secret123',
            email: 'admin@example.com'
        };
    }

    getData() {
        return this.data;
    }

    setData(key, value) {
        this.data[key] = value;
        console.log(`æ•°æ®å·²æ›´æ–°: ${key} = ${value}`);
    }
}

// ä¿æŠ¤ä»£ç†
class ProtectedDataProxy {
    constructor(user) {
        this.user = user;
        this.sensitiveData = new SensitiveData();
    }

    // æ£€æŸ¥æƒé™
    checkAccess() {
        return this.user.role === 'admin';
    }

    getData() {
        if (this.checkAccess()) {
            console.log('âœ… æƒé™éªŒè¯é€šè¿‡ï¼Œå…è®¸è®¿é—®æ•°æ®');
            return this.sensitiveData.getData();
        } else {
            console.log('âŒ æƒé™ä¸è¶³ï¼Œæ‹’ç»è®¿é—®');
            throw new Error('æ²¡æœ‰è®¿é—®æƒé™');
        }
    }

    setData(key, value) {
        if (this.checkAccess()) {
            console.log('âœ… æƒé™éªŒè¯é€šè¿‡ï¼Œå…è®¸ä¿®æ”¹æ•°æ®');
            this.sensitiveData.setData(key, value);
        } else {
            console.log('âŒ æƒé™ä¸è¶³ï¼Œæ‹’ç»ä¿®æ”¹');
            throw new Error('æ²¡æœ‰ä¿®æ”¹æƒé™');
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const adminUser = { name: 'Alice', role: 'admin' };
const normalUser = { name: 'Bob', role: 'user' };

// ç®¡ç†å‘˜è®¿é—®
const adminProxy = new ProtectedDataProxy(adminUser);
console.log('ç®¡ç†å‘˜è®¿é—®:');
console.log(adminProxy.getData());
adminProxy.setData('email', 'newemail@example.com');

// æ™®é€šç”¨æˆ·è®¿é—®
const userProxy = new ProtectedDataProxy(normalUser);
console.log('\næ™®é€šç”¨æˆ·è®¿é—®:');
try {
    userProxy.getData();
} catch (error) {
    console.log(`é”™è¯¯: ${error.message}`);
}</code></pre>
        </div>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ’¾ ç¼“å­˜ä»£ç†ç¤ºä¾‹</h3>
        <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <pre class="line-numbers"><code class="language-javascript">// è®¡ç®—å¯†é›†å‹æ“ä½œ
class Calculator {
    // è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé€’å½’ï¼Œæ€§èƒ½è¾ƒå·®ï¼‰
    fibonacci(n) {
        console.log(`è®¡ç®— fibonacci(${n})`);
        if (n <= 1) return n;
        return this.fibonacci(n - 1) + this.fibonacci(n - 2);
    }
}

// ç¼“å­˜ä»£ç†
class CachedCalculator {
    constructor() {
        this.calculator = new Calculator();
        this.cache = new Map();
    }

    fibonacci(n) {
        // æ£€æŸ¥ç¼“å­˜
        if (this.cache.has(n)) {
            console.log(`ğŸ“¦ ä»ç¼“å­˜è·å– fibonacci(${n})`);
            return this.cache.get(n);
        }

        // è®¡ç®—å¹¶ç¼“å­˜ç»“æœ
        const result = this.calculator.fibonacci(n);
        this.cache.set(n, result);
        return result;
    }

    clearCache() {
        this.cache.clear();
        console.log('ç¼“å­˜å·²æ¸…ç©º');
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const cachedCalc = new CachedCalculator();

console.log('ç¬¬ä¸€æ¬¡è®¡ç®—:');
console.log(`ç»“æœ: ${cachedCalc.fibonacci(10)}`);

console.log('\nç¬¬äºŒæ¬¡è®¡ç®—ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰:');
console.log(`ç»“æœ: ${cachedCalc.fibonacci(10)}`);

console.log('\nè®¡ç®—å¦ä¸€ä¸ªå€¼:');
console.log(`ç»“æœ: ${cachedCalc.fibonacci(5)}`);</code></pre>
        </div>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸŒ ES6 Proxy å¯¹è±¡</h3>
        <p class="text-gray-700 mb-4">
            JavaScript åŸç”Ÿæä¾›äº† <code class="bg-gray-100 px-2 py-1 rounded text-sm">Proxy</code> å¯¹è±¡ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°ä»£ç†æ¨¡å¼ã€‚
        </p>
        <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <pre class="line-numbers"><code class="language-javascript">// ä½¿ç”¨ ES6 Proxy å®ç°å±æ€§è®¿é—®æ‹¦æˆª
const user = {
    name: 'John',
    age: 30,
    _password: 'secret123'  // ç§æœ‰å±æ€§
};

const userProxy = new Proxy(user, {
    // æ‹¦æˆªå±æ€§è¯»å–
    get(target, property) {
        if (property.startsWith('_')) {
            console.log(`âŒ ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§: ${property}`);
            return undefined;
        }
        console.log(`âœ… è¯»å–å±æ€§: ${property}`);
        return target[property];
    },

    // æ‹¦æˆªå±æ€§è®¾ç½®
    set(target, property, value) {
        if (property.startsWith('_')) {
            console.log(`âŒ ä¸èƒ½ä¿®æ”¹ç§æœ‰å±æ€§: ${property}`);
            return false;
        }
        if (property === 'age' && typeof value !== 'number') {
            console.log(`âŒ age å¿…é¡»æ˜¯æ•°å­—ç±»å‹`);
            return false;
        }
        console.log(`âœ… è®¾ç½®å±æ€§: ${property} = ${value}`);
        target[property] = value;
        return true;
    },

    // æ‹¦æˆªå±æ€§åˆ é™¤
    deleteProperty(target, property) {
        if (property.startsWith('_')) {
            console.log(`âŒ ä¸èƒ½åˆ é™¤ç§æœ‰å±æ€§: ${property}`);
            return false;
        }
        console.log(`âœ… åˆ é™¤å±æ€§: ${property}`);
        delete target[property];
        return true;
    }
});

// ä½¿ç”¨ç¤ºä¾‹
console.log('è¯»å–å…¬å…±å±æ€§:');
console.log(userProxy.name);  // âœ… è¯»å–å±æ€§: name

console.log('\nå°è¯•è¯»å–ç§æœ‰å±æ€§:');
console.log(userProxy._password);  // âŒ ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§

console.log('\nè®¾ç½®å±æ€§:');
userProxy.age = 31;  // âœ… è®¾ç½®å±æ€§: age = 31

console.log('\nå°è¯•è®¾ç½®é”™è¯¯ç±»å‹:');
userProxy.age = '32';  // âŒ age å¿…é¡»æ˜¯æ•°å­—ç±»å‹</code></pre>
        </div>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ“Š æ•°æ®éªŒè¯ä»£ç†</h3>
        <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <pre class="line-numbers"><code class="language-javascript">// åˆ›å»ºæ•°æ®éªŒè¯ä»£ç†
function createValidatedObject(target, validators) {
    return new Proxy(target, {
        set(obj, property, value) {
            // æ£€æŸ¥æ˜¯å¦æœ‰éªŒè¯å™¨
            if (validators[property]) {
                const validator = validators[property];
                if (!validator(value)) {
                    console.log(`âŒ éªŒè¯å¤±è´¥: ${property} = ${value}`);
                    return false;
                }
            }
            console.log(`âœ… éªŒè¯é€šè¿‡: ${property} = ${value}`);
            obj[property] = value;
            return true;
        }
    });
}

// å®šä¹‰éªŒè¯è§„åˆ™
const validators = {
    email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
    age: (value) => typeof value === 'number' && value >= 0 && value <= 150,
    username: (value) => typeof value === 'string' && value.length >= 3
};

// åˆ›å»ºéªŒè¯å¯¹è±¡
const userForm = createValidatedObject({}, validators);

// æµ‹è¯•éªŒè¯
console.log('è®¾ç½®æœ‰æ•ˆçš„é‚®ç®±:');
userForm.email = 'user@example.com';  // âœ… éªŒè¯é€šè¿‡

console.log('\nè®¾ç½®æ— æ•ˆçš„é‚®ç®±:');
userForm.email = 'invalid-email';  // âŒ éªŒè¯å¤±è´¥

console.log('\nè®¾ç½®æœ‰æ•ˆçš„å¹´é¾„:');
userForm.age = 25;  // âœ… éªŒè¯é€šè¿‡

console.log('\nè®¾ç½®æ— æ•ˆçš„å¹´é¾„:');
userForm.age = 200;  // âŒ éªŒè¯å¤±è´¥

console.log('\nè®¾ç½®æœ‰æ•ˆçš„ç”¨æˆ·å:');
userForm.username = 'john_doe';  // âœ… éªŒè¯é€šè¿‡

console.log('\nè®¾ç½®æ— æ•ˆçš„ç”¨æˆ·å:');
userForm.username = 'ab';  // âŒ éªŒè¯å¤±è´¥</code></pre>
        </div>

        <h3 class="text-xl font-semibold mb-4 mt-6 text-gray-800">âœ… åº”ç”¨åœºæ™¯</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 mb-6">
            <li><strong>æƒé™æ§åˆ¶ï¼š</strong>åœ¨è®¿é—®æ•æ„Ÿæ•°æ®å‰è¿›è¡Œæƒé™éªŒè¯</li>
            <li><strong>å»¶è¿ŸåŠ è½½ï¼š</strong>æ¨è¿Ÿåˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡ï¼Œæé«˜æ€§èƒ½</li>
            <li><strong>ç¼“å­˜ä¼˜åŒ–ï¼š</strong>ç¼“å­˜è®¡ç®—ç»“æœæˆ–ç½‘ç»œè¯·æ±‚ï¼Œå‡å°‘é‡å¤æ“ä½œ</li>
            <li><strong>æ—¥å¿—è®°å½•ï¼š</strong>è®°å½•å¯¹è±¡çš„è®¿é—®å’Œä¿®æ”¹å†å²</li>
            <li><strong>æ•°æ®éªŒè¯ï¼š</strong>åœ¨è®¾ç½®å±æ€§å‰è¿›è¡Œæ•°æ®éªŒè¯</li>
            <li><strong>è¿œç¨‹ä»£ç†ï¼š</strong>ä¸ºè¿œç¨‹å¯¹è±¡æä¾›æœ¬åœ°ä»£è¡¨ï¼ˆå¦‚ RPCï¼‰</li>
            <li><strong>é˜²æŠ–èŠ‚æµï¼š</strong>æ§åˆ¶å‡½æ•°çš„è°ƒç”¨é¢‘ç‡</li>
        </ul>

        <h3 class="text-xl font-semibold mb-4 text-gray-800">ğŸ¯ å®æˆ˜æ¡ˆä¾‹</h3>
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-6">
            <p class="text-gray-700 mb-2">
                <strong>æ¡ˆä¾‹é¢„å‘Šï¼š</strong>
            </p>
            <ul class="text-gray-600 space-y-1">
                <li>â€¢ å›¾ç‰‡æ‡’åŠ è½½ä»£ç†</li>
                <li>â€¢ API è¯·æ±‚ç¼“å­˜ä»£ç†</li>
                <li>â€¢ è¡¨å•æ•°æ®éªŒè¯ä»£ç†</li>
                <li>â€¢ æ€§èƒ½ç›‘æ§ä»£ç†</li>
            </ul>
            <p class="text-gray-600 mt-3 text-sm italic">
                è¯¦ç»†çš„å®æˆ˜æ¡ˆä¾‹å°†åœ¨åç»­è¡¥å……...
            </p>
        </div>

        <!-- ä¼˜ç¼ºç‚¹åˆ†æ -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <h4 class="font-semibold text-green-800 mb-2">âœ… ä¼˜ç‚¹</h4>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>â€¢ æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®</li>
                    <li>â€¢ å¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„æƒ…å†µä¸‹å¢åŠ åŠŸèƒ½</li>
                    <li>â€¢ ç¬¦åˆå¼€é—­åŸåˆ™å’Œå•ä¸€èŒè´£åŸåˆ™</li>
                    <li>â€¢ å¯ä»¥å®ç°å»¶è¿ŸåŠ è½½ï¼Œæé«˜æ€§èƒ½</li>
                    <li>â€¢ å¯ä»¥æ·»åŠ ç¼“å­˜ã€æ—¥å¿—ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹</li>
                </ul>
            </div>
            <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
                <h4 class="font-semibold text-orange-800 mb-2">âš ï¸ ç¼ºç‚¹</h4>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>â€¢ å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦</li>
                    <li>â€¢ å¯èƒ½ä¼šé™ä½å¤„ç†é€Ÿåº¦</li>
                    <li>â€¢ éœ€è¦é¢å¤–çš„ä»£ç†å¯¹è±¡</li>
                    <li>â€¢ æŸäº›ä»£ç†æ¨¡å¼å®ç°è¾ƒä¸ºå¤æ‚</li>
                </ul>
            </div>
        </div>

        <!-- ä¸å…¶ä»–æ¨¡å¼çš„å¯¹æ¯” -->
        <div class="mt-6 bg-purple-50 border-l-4 border-purple-500 p-4 rounded">
            <h4 class="font-semibold text-purple-800 mb-3">ğŸ”„ ä¸å…¶ä»–æ¨¡å¼çš„åŒºåˆ«</h4>
            <div class="space-y-2 text-sm text-gray-700">
                <p><strong>ä»£ç†æ¨¡å¼ vs è£…é¥°å™¨æ¨¡å¼ï¼š</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>ä»£ç†æ¨¡å¼ï¼šæ§åˆ¶è®¿é—®ï¼Œä»£ç†å’Œç›®æ ‡å¯¹è±¡å®ç°ç›¸åŒæ¥å£</li>
                    <li>è£…é¥°å™¨æ¨¡å¼ï¼šå¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å¤šä¸ªè£…é¥°å™¨</li>
                </ul>
                <p class="mt-2"><strong>ä»£ç†æ¨¡å¼ vs é€‚é…å™¨æ¨¡å¼ï¼š</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>ä»£ç†æ¨¡å¼ï¼šæ¥å£ç›¸åŒï¼Œæ§åˆ¶è®¿é—®</li>
                    <li>é€‚é…å™¨æ¨¡å¼ï¼šæ¥å£ä¸åŒï¼Œè½¬æ¢æ¥å£</li>
                </ul>
            </div>
        </div>
    </div>
</section>
